---
title: "Relaciones entre Géneros"
author:
- David Quesada
- Julian Cruz
- Tomas Guerra
- Juliana Borja
- Nadia 
date: ''
output:
  html_document:
    number_sections: true
    theme: paper
  pdf_document: 
    toc: true
    highlight: espresso
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introducción

**Procesamiento de lenguaje natural** (*natural language processing*) o **lingüística computacional** (*computational linguistics*).

Extraer significado algorítmicamente de textos.

Los computadores son buenos para procesar texto, pero no son buenos entendiéndolo. Por el contrario los humanos son buenos para entender texto, pero no son buenos para procesarlo.


## Objetivos {-}

- Identificar palabras con mayor importancia.
- Cuantificar relaciones y conexiones entre palabras.


# Caso de estudio:

## Baladas:

Artistas:

1)Manuel_Medrano:
-Canciones: Bajo_el_Agua_Una_y_otra_vez_La_Mujer_Que_Bota_Fuego_Si_Pudiera_La_Distancia{-}
2)Andres_Cepeda:
-Canciones: Lo_Mejor_Que_Hay_en_mi_Vida_Mejor_que_a_ti_me_va_Besos_Usados_Tengo_Ganas{-}
3)Morat:
-Canciones: Como_te_Atreves_Besos_en_Guerra_Aprender_a_Quererte_a_donde_Vamos{-}
4)Cara_Luna:
-Canciones: Mi_Primer_Millon_Tabaco_Chanel_Pasos_Gigantes_Perderme_contigo{-}


 https://www.letras.com/manuel-medrano/bajo-el-agua/
 https://www.letras.com/manuel-medrano/una-y-otra-vez/
 https://www.letras.com/manuel-medrano/la-mujer-que-bota-fuego/
 https://www.letras.com/manuel-medrano/si-pudiera/
 https://www.letras.com/manuel-medrano/la-distancia/
 https://www.letras.com/andres-cepeda/lo-mejor-que-hay-en-mi-vida/
 https://www.letras.com/andres-cepeda/mejor-que-a-ti-me-va/
 https://www.letras.com/andres-cepeda/1792354/
 https://www.letras.com/andres-cepeda/266343/
 https://www.letras.com/morat/como-te-atreves/
 https://www.letras.com/morat/besos-en-guerra/
 https://www.letras.com/morat/aprender-a-quererte/
 https://www.letras.com/morat/a-donde-vamos/ 
 https://www.letras.com/bacilos/65340/
 https://www.letras.com/bacilos/65341/
 https://www.letras.com/bacilos/65342/
 https://www.letras.com/bacilos/pasos-de-gigantes/
 https://www.letras.com/bacilos/perderme-contigo/

## Reggaeton:

Artistas:

1)Reykon:
-Canciones: el_lider_El_chisme_Remix_Tu_Cuerpo_Me_Llama_Remix_El_Error_La_Santa_Ginza_Remix_Secretos_Domingo_Imaginandote{-}
2)J_Balvin:
-Canciones: Ay_Vamos_6_Am_Rojo_Culpables_Safari_Mi_Gente_No_Es_Justo_Blanco{-}
3)Manuel_Turizo:
-Canciones: Una_Lady_Como_Tu_Esclavos_de_tus_Besos_La_Bachata{-}
4)Maluma:
-Canciones: Hawai_Borro_Cassette_El_Perdedor_Addicted_Carnaval_Cosas_Pendientes

 https://www.youtube.com/watch?v=3xinCpjWxxU
 https://www.youtube.com/watch?v=jgQ2MSwgC6A
 https://www.youtube.com/watch?v=C3jp2lid58g
 https://www.youtube.com/watch?v=u5KFYnfKgWo
 https://www.youtube.com/watch?v=m8JoSkGVsFA
 https://www.youtube.com/watch?v=TapXs54Ah3E
 https://www.youtube.com/watch?v=yUV9JwiQLog&pp=ygUDNmFt
 https://www.youtube.com/watch?v=_tG70FWd1Ds&pp=ygUEcm9qbw%3D%3D
 https://www.youtube.com/watch?v=VYtJAuoZxcc&pp=ygUQdW5hIGxhZHkgY29tbyB0dQ%3D%3D
 https://www.youtube.com/watch?v=1afoVNPPQCI&pp=ygUUZXNjbGF2byBkZSB0dXMgYmVzb3M%3D
 https://www.youtube.com/watch?v=TiM_TFpT_DE&pp=ygUKbGEgYmFjaGF0YQ%3D%3D 
 https://www.youtube.com/watch?v=ZFwpzIz8eWE&pp=ygUIc2VjcmV0b3M%3D
 https://www.youtube.com/watch?v=f7uFHxg6nks&pp=ygUMaW1hZ2luYW5kb3Rl
 https://www.youtube.com/watch?v=KIvhiN0WHfY&pp=ygUHZG9taW5nbw%3D%3D
 https://www.youtube.com/watch?v=JWESLtAKKlU&pp=ygUGc2FmYXJp
 https://www.youtube.com/watch?v=wnJ6LuUFpMo&pp=ygUIbWkgZ2VudGU%3D
 https://www.youtube.com/watch?v=2zn4dAuZ2RU&pp=ygULbm8gZXMganVzdG8%3D
 https://www.youtube.com/watch?v=8j1xiiAZhIQ&pp=ygUGYmxhbmNv
 https://www.youtube.com/watch?v=pK060iUFWXg&pp=ygUGaGF3YWlp
 https://www.youtube.com/watch?v=Xk0wdDTTPA0&pp=ygUVYm9ycm8gY2Fzc2V0dGUgbWFsdW1h0gcJCY0JAYcqIYzv
 https://www.youtube.com/watch?v=PJniSb91tvo&pp=ygULZWwgcGVyZGVkb3LSBwkJjQkBhyohjO8%3D
 https://www.youtube.com/watch?v=pMIHC_cItd4&pp=ygUPYWRkaWN0ZWQgbWFsdW1h
 https://www.youtube.com/watch?v=ufa0K9w9z2c&pp=ygUPY2FybmF2YWwgbWFsdW1h
 https://www.youtube.com/watch?v=6vPhcRew8hA&pp=ygUQY29zYXMgcGVuZGllbnRlcw%3D%3D
 
## Rock:

Artistas:

1)Los_De_Adentro:
-Canciones: Nubes_Negras_Quiero_Amarte_No_Mas_Tal_Vez{-}
2)Kraken:
-Canciones: Fragil_al_Viento_Vestido_de_Cristal_America_Silencioso_Amor_Arteciopelados_Baracunata_Florecita_Rockera{-}
3)Caifanes:
-Canciones: Afuera_Viento_No_dejes_que{-}
4)Enanitos_Verdes:
-Canciones: La_Muralla_Verde{-}

 https://youtu.be/8_Tc5uP8SL4?si=DvK_wDQjGbTRIebT
 https://youtu.be/8hGAklEil10?si=G5-nZzi1n0rdJprE
 https://youtu.be/s09hOXaPhJ8?si=YLYijSYH1bMkCWnS
 https://youtu.be/HqiX6-f5w-s?si=Ar1XWmjQP62TSuJX
 https://youtu.be/1tVF5rpmFM4?si=N9ItbxZCNnGU8tBm
 https://youtu.be/I4YtarQbE7U?si=GbTw8n7ih3JVFAyN
 https://youtu.be/Pcy_F40W9EM?si=_DXgEk08DYAgLU2F
 https://youtu.be/Q3ReRsnYG4I?si=mmNq8bDT1ONyJpL1
 https://youtu.be/mqOCHYhRaGY?si=hKE0l0zyVzcQQr8V
 https://youtu.be/ARR3gkzX8I0?si=JCz3UO1Uzjz6FijW
 https://youtu.be/DNbG5IIA71w?si=v1-D2Rjm-HVVkx_a
 https://youtu.be/9KIshSBiojI?si=gZcaeeLWVnf73mxa
 https://youtu.be/i17Go6G-siA?si=E5JJA9aPvYxDtITo
 https://youtu.be/tYGZ1YCD2YU?si=vIcjZ9h9ZK69-omp

## Salsa:

Artistas:

1)Joe_Arroyo:
-Canciones: Rebelión_En_Barranquilla_me_quedo_Tal_para_cual_Pa’l_bailador_Te_quiero_más{-}
2)Fruko_y_sus_Tesos:
-Canciones: El_Preso_Los_Charcos_Cachondea_El_Ausente_El_Son_del_Tren{-}
3)Grupo_Niche:
-Canciones: Sin_sentimiento_Algo_que_se_quede_Cali_pachanguero_Se_pareció_tanto_a_ti_Una_aventura{-}
4)Yuri_Buenaventura:
-Canciones: No_Estoy_contigo_¿Dónde_Estás?_Salsa_Tu_Cancion_El_Guerrero{-}

 https://www.youtube.com/watch?v=7HtWEPfQJxw
 https://www.youtube.com/watch?v=ms3VDvksgks
 https://www.youtube.com/watch?v=I3eXeVRqtHQ
 https://www.youtube.com/watch?v=o0Bn_qVzZvE
 https://www.youtube.com/watch?v=NlemaAlPeZs
 
# Importar texto
```{r}
##### importar datos
suppressMessages(suppressWarnings(library(readr)))
suppressMessages(suppressWarnings(library(tidyverse)))
# warnings debido a caracteres no UTF-8 o vacios ("")
# UTF-8 (8-bit Unicode Transformation Format) es un formato de codificación de caracteres 
# capaz de codificar todos los code points validos en Unicode
text_Baladas <- read_csv("baladas.txt", col_names = FALSE, show_col_types = FALSE)
class(text_Baladas)
text_Baladas <- c(text_Baladas)
class(text_Baladas)
text_Baladas <- unlist(text_Baladas)
class(text_Baladas)
names(text_Baladas) <- NULL  # importante!
head(text_Baladas, n = 3)
# Reggaeton
text_Reggaeton <- unlist(c(read_csv("Reggaeton_proyecto.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Reggaeton) <- NULL
# Rock 
text_Rock_canciones <- unlist(c(read_csv("Rock_canciones.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Rock_canciones) <- NULL
# Salsa 
text_Salsa_canciones <- unlist(c(read_csv("Salsa_canciones.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Salsa_canciones) <- NULL
```


```{r}
##### data frame formato tidy
# Baladas
text_Baladas <- tibble(line = 1:length(text_Baladas), text = text_Baladas)  # tibble en lugar de data_frame
class(text_Baladas)
dim(text_Baladas)
head(text_Baladas, n = 3)
# texto no normalizado
# no tiene "estructura" para analizar
# Reggaeton
text_Reggaeton<- tibble(line = 1:length(text_Reggaeton), text = text_Reggaeton)
# Rock canciones 
text_Rock_canciones<- tibble(line = 1:length(text_Rock_canciones), text = text_Rock_canciones)
# Salsa canciones 
text_Salsa_canciones<- tibble(line = 1:length(text_Salsa_canciones), text = text_Salsa_canciones)
```



# Tokenización

Almacenar el texto en formato estructurado.

Token: unidad de análisis.

La tokenización básica consiste en que cada token es una palabra.

Formato de de un token por linea.

Por defecto se elimina la puntuación y se normaliza el texto a minúsculas (las tíldes no se eliminan por defecto).


```{r}
suppressMessages(suppressWarnings(library(tidytext)))
suppressMessages(suppressWarnings(library(magrittr)))
##### tokenizacion formato tidy
# ---------- Baladas ----------
text_Baladas %<>%
  unnest_tokens(input = text, output = word) %>%
  filter(!is.na(word))  # importante!
class(text_Baladas)
dim(text_Baladas)
head(text_Baladas, n = 10)
# ---------- Reggaeton ----------
text_Reggaeton %<>%
  unnest_tokens(input = text, output = word) %>%
  filter(!is.na(word))
dim(text_Reggaeton)
head(text_Reggaeton, n = 10)
# -----------Rock_canciones-------
text_Rock_canciones%<>%
    unnest_tokens(input = text, output = word) %>%
    filter(!is.na(word))
dim(text_Rock_canciones)
head(text_Rock_canciones, n = 10)
# -----------Salsa_canciones-------
text_Salsa_canciones%<>%
    unnest_tokens(input = text, output = word) %>%
    filter(!is.na(word))
dim(text_Salsa_canciones)
head(text_Salsa_canciones, n = 10)
```

# Normalización del texto

Remover:

- Minúsculas.
- Puntuación.
- Símbolos especiales (e.g., \#).
- Números.
- Acentos. 
- Sufijos (e.g., conservar "comput" en lugar de "computational", "computers", "computation").
- *Stop words* (e.g., artículos, preposiciones).


```{r}
##### texto con numeros?
# ---------- Baladas ----------
text_Baladas %>%
  filter(grepl(pattern = '[0-9]', x = word)) %>% 
  count(word, sort = TRUE)
# ---------- Reggaeton ----------
text_Reggaeton %>%
  filter(grepl(pattern = '[0-9]', x = word)) %>% 
  count(word, sort = TRUE)
# ------------Rock_canciones-----------
text_Rock_canciones %>%
    filter(grepl(pattern = '[0-9]', x = word)) %>%
    count(word, sort = TRUE)
# ------------Salsa_canciones-----------
text_Salsa_canciones %>%
    filter(grepl(pattern = '[0-9]', x = word)) %>%
    count(word, sort = TRUE)
```

```{r}
##### remover texto con numeros
# ---------- Baladas ----------
text_Baladas %<>%
  filter(!grepl(pattern = '[0-9]', x = word))
dim(text_Baladas)
# ---------- Reggaeton ----------
text_Reggaeton %<>%
  filter(!grepl(pattern = '[0-9]', x = word))
dim(text_Reggaeton)
# -----------Rock_canciones-----
text_Rock_canciones %<>%
  filter(!grepl(pattern = '[0-9]', x = word))
dim(text_Rock_canciones)
# -----------Salsa_canciones-----
text_Salsa_canciones %<>%
  filter(!grepl(pattern = '[0-9]', x = word))
dim(text_Salsa_canciones)
```


```{r}
##### stop words 
# 3 diccionarios en ingles (onix, SMART, snowball) incluidos por defecto en tidytext
data(stop_words)
class(stop_words)
dim(stop_words)
head(stop_words, n = 10)
table(stop_words$lexicon)
```



```{r}
###### stop words 
# no hay diccionarios en español disponibles en tidytext
# diccionario COUNTWORDSFREE en español (con acentos)
# http://countwordsfree.com/stopwords/spanish
# otras alternativas:
#   https://github.com/stopwords-iso/stopwords-es
#   de tm::stopwords("spanish")
# se conserva el mismo formato de los diccionarios en tidytext
stop_words_es <- tibble(word = unlist(c(read.table("Stopwords.txt", quote="\"", comment.char=""))), lexicon = "custom")
dim(stop_words_es)
head(stop_words_es, n = 10)
```



```{r}
##### remover stop words
# ---------- Baladas ----------
text_Baladas %<>% 
  anti_join(x = ., y = stop_words_es)
dim(text_Baladas)
head(text_Baladas, n = 10)
# ---------- Reggaeton ----------
text_Reggaeton %<>% 
  anti_join(x = ., y = stop_words_es)
dim(text_Reggaeton)
head(text_Reggaeton, n = 10)
#-----------Rock_canciones------
text_Rock_canciones %<>%
    anti_join(x = . , y = stop_words_es)
dim(text_Rock_canciones)
head(text_Rock_canciones, n = 10)
#-----------Salsa_canciones------
text_Salsa_canciones %<>%
    anti_join(x = . , y = stop_words_es)
dim(text_Salsa_canciones)
head(text_Salsa_canciones, n = 10)
```



```{r}
##### remover acentos
replacement_list <- list('á' = 'a', 'é' = 'e', 'í' = 'i', 'ó' = 'o', 'ú' = 'u')
# ---------- Baladas ----------
text_Baladas %<>% 
  mutate(word = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word))
dim(text_Baladas)
head(text_Baladas, n = 10)
# ---------- Reggaeton ----------
text_Reggaeton %<>% 
  mutate(word = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word))
dim(text_Reggaeton)
head(text_Reggaeton, n = 10)
#-----------------Rock_canciones-------------
text_Rock_canciones %<>%
  mutate(word = chartr(old = names(replacement_list)%>% str_c(collapse = ''),
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word))
dim(text_Rock_canciones)
head(text_Rock_canciones, n= 10)
#-----------------Salsa_canciones-------------
text_Salsa_canciones %<>%
  mutate(word = chartr(old = names(replacement_list)%>% str_c(collapse = ''),
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word))
dim(text_Salsa_canciones)
head(text_Salsa_canciones, n= 10)
```


# Tokens más frecuentes



```{r}
##### top 10 de tokens mas frecuentes
# ---------- Baladas ----------
text_Baladas%>% 
  count(word, sort = TRUE) %>%
  head(n = 10)
# ---------- Reggaeton ----------
text_Reggaeton%>% 
  count(word, sort = TRUE)  %>%
  head(n = 10)
#------------Rock_canciones-------------
text_Rock_canciones%>%
  count(word, sort = TRUE) %>%
  head(n = 10)
#------------Salsa_canciones-------------
text_Salsa_canciones%>%
  count(word, sort = TRUE) %>%
  head(n = 10)
```



```{r, fig.width=10, fig.height=5, fig.align='center'}
##### viz
suppressMessages(suppressWarnings(library(gridExtra)))
# ---------- Baladas ----------
text_Baladas %>%
  count(word, sort = TRUE) %>%
  filter(n > 14) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(x = word, y = n)) +
    theme_light() + 
    geom_col(fill = 'red4', alpha = 0.8) +
    xlab(NULL) +
    ylab("Frecuencia") +
    coord_flip() +
    ggtitle(label = 'Baladas: Conteo de palabras') -> p1
# ---------- Reggaeton ----------
text_Reggaeton %>%
  count(word, sort = TRUE) %>%
  filter(n > 10) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(x = word, y = n)) +
    theme_light() + 
    geom_col(fill = 'blue4', alpha = 0.8) +
    xlab(NULL) +
    ylab("Frecuencia") +
    coord_flip() +
    ggtitle(label = 'Reggaeton: Conteo de palabras') -> p2
#-----------Rock_canciones--------
text_Rock_canciones %>%
  count(word, sort = TRUE) %>%
  filter(n > 10) %>%
  mutate(word = reorder(word,n)) %>%
  ggplot(aes(x = word, y = n)) +
    theme_light()+
    geom_col(fill= 'purple4', alpha = 0.8)+
    xlab(NULL)+
    ylab("Frecuencia")+
    coord_flip()+
    ggtitle(label = 'Rock: Conteo de palabras') -> p3
#-----------Salsa_canciones--------
text_Salsa_canciones %>%
  count(word, sort = TRUE) %>%
  filter(n > 15) %>%
  mutate(word = reorder(word,n)) %>%
  ggplot(aes(x = word, y = n)) +
    theme_light()+
    geom_col(fill= 'yellow4', alpha = 0.8)+
    xlab(NULL)+
    ylab("Frecuencia")+
    coord_flip()+
    ggtitle(label = 'Salsa: Conteo de palabras') -> p4
# desplegar grafico 
grid.arrange(p1, p2, p3, p4)
```



```{r, fig.width=10, fig.height=5, fig.align='center'}
suppressMessages(suppressWarnings(library(wordcloud)))
###### viz
par(mfrow = c(2,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# ---------- Baladas ----------
set.seed(123)
text_Baladas %>%
  count(word, sort = TRUE) %>%
  with(wordcloud(words = word, freq = n, max.words = 12, colors = 'red4'))
title(main = "Baladas: Nube de Palabras")
# ---------- Reggaeton ----------
set.seed(123)
text_Reggaeton %>%
  count(word, sort = TRUE) %>%
  with(wordcloud(words = word, freq = n, max.words = 10, colors = 'blue4'))
title(main = "Reggaeton: Nube de Palabras")
#-------------Rock_canciones-----------
set.seed(123)
text_Rock_canciones %>%
  count(word, sort = TRUE) %>%
  with(wordcloud(words = word, freq = n, max.words = 10, colors = 'purple4'))
title(main = "Rock: Nube de Palabras")
#-------------Salsa_canciones-----------
set.seed(1234)
text_Salsa_canciones %>%
  count(word, sort = TRUE) %>%
  with(wordcloud(words = word, freq = n, max.words = 10, colors = 'yellow4'))
title(main = "Salsa: Nube de Palabras")
```


```{r}
##### frecuencias relativas de la palabras
bind_rows(mutate(.data = text_Baladas, author = "Baladas"),
                       mutate(.data = text_Reggaeton, author = "Reggaeton"),
                        mutate(.data = text_Rock_canciones, author = "Rock_canciones"),
                          mutate(.data = text_Salsa_canciones, author = "Salsa_canciones")) %>%
  count(author, word) %>%
  group_by(author) %>%
  mutate(proportion = n/sum(n)) %>%
  select(-n) %>%
  spread(author, proportion, fill = 0) -> frec  # importante!
frec %<>% 
  select(word, Baladas, Reggaeton, Rock_canciones, Salsa_canciones)
dim(frec)
head(frec, n = 10)
```


```{r}
##### top 10 palabras en comun
# orden anidado respecto a Baladas, Reggaeton, Rock y Salsa
frec %>%
  filter(Baladas !=0, Reggaeton != 0, Rock_canciones != 0) %>%
  arrange(desc(Baladas), desc(Reggaeton), desc(Rock_canciones), desc(Salsa_canciones)) -> frec_comun
dim(frec_comun)
head(frec_comun, n = 10)
```


```{r}
###### proporcion palabras en comun
dim(frec_comun)[1]/dim(frec)[1]
```



```{r}
##### correlacion de las frecuencias
# cuidado con los supuestos de la prueba
# es posible usar Bootstrap como alternativa
cor.test(x = frec$Baladas, y = frec$Baladas)
cor.test(x = frec_comun$Reggaeton, y = frec_comun$Reggaeton)
cor.test(x = frec_comun$Rock_canciones, y = frec_comun$Rock_canciones)
cor.test(x = frec_comun$Salsa_canciones, y = frec_comun$Salsa_canciones)
```



# Análisis de sentimiento

A las palabras (tokens simples o unigramas) se les asigna un **puntaje** (escala, positivo/negativo, emoción).

El **sentimiento** se define como la suma del puntaje de las palabras individuales.

Diccionarios:

- Basados en tokens simples, no expresiones compuestas (e.g. "no good").
- Hay palabras neutras.

Objetivos:

- Entender actitudes y opiniones.
- Identificar flujos de narrativas.
- Cuantificar la contribución de palabras en la expresión de un sentimiento.
- Abordar el contenido emocional de un texto algorítmicamente.

Caveats:

- Tener en cuenta sarcasmo y expresiones compuestas en la interpretación.
- Cuidado con los cambios semánticos debido a composiciones de unigramas. Por ejemplo, como "I'm not happy and I don't like it!" dado que las que esta compuesta palabras positivas (¡hacer n-gramas).


```{r}
##### sentiments 
# 3 diccionarios en ingles (AFINN, Bing, NRC) incluidos por defecto en tidytext
# AFINN: Finn Arup Nielsen, escala de -5 a 5.
#   http://www2.imm.dtu.dk/pubdb/views/publication_details.php?id=6010
# Bing: Bing Liu and collaborators, clasificacion binaria (+/-).
#   https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html
# NRC: Saif Mohammad and Peter Turney, clasificacion binaria (+/-) y algunas categorias.
#   http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm
```



```{r}
# diccionarios
# no hay diccionarios en español disponibles en tidytext
# https://www.kaggle.com/datasets/rtatman/sentiment-lexicons-for-81-languages
positive_words <- read_csv("Positive_words.txt", col_names = "word", show_col_types = FALSE) %>%
  mutate(sentiment = "Positivo")
negative_words <- read_csv("Negativewords.txt", col_names = "word", show_col_types = FALSE) %>%
  mutate(sentiment = "Negativo")
sentiment_words <- bind_rows(positive_words, negative_words)
# comparacion de diccionarios
get_sentiments("bing") %>%
  count(sentiment)
sentiment_words %>%
  count(sentiment)
```


```{r, fig.width=11, fig.height=4, fig.align='center'}
###### viz
suppressMessages(suppressWarnings(library(RColorBrewer)))
# ---------- Baladas ----------
text_Baladas %>%
  inner_join(sentiment_words) %>%
  count(word, sentiment, sort = TRUE) %>%
  filter(n > 2) %>%
  mutate(n = ifelse(sentiment == "Negativo", -n, n)) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sentiment)) +
    geom_col() +
    scale_fill_manual(values = brewer.pal(8,'Dark2')[c(2,5)]) +
    coord_flip(ylim = c(-7,7)) +
    labs(y = "Frecuencia",
         x = NULL,
         title = "Baladas") +
    theme_minimal() +
    theme(legend.position = "none") -> p1
# ---------- Reggaeton ----------
text_Reggaeton %>%
  inner_join(sentiment_words) %>%
  count(word, sentiment, sort = TRUE) %>%
  filter(n > 2) %>%
  mutate(n = ifelse(sentiment == "Negativo", -n, n)) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sentiment)) +
    geom_col() +
    scale_fill_manual(values = brewer.pal(8,'Dark2')[c(2,5)]) +
    coord_flip(ylim = c(-7,7)) +
    labs(y = "Frecuencia",
         x = NULL,
         title = "Reggaeton") +
    theme_minimal() +
    theme(legend.position = "none") -> p2 
#-------------Rock_canciones------------------
text_Rock_canciones %>%
    inner_join(sentiment_words) %>%
    count(word, sentiment, sort = TRUE) %>%
    filter(n > 2) %>%
    mutate(n = ifelse(sentiment == "Negativo", -n, n)) %>%
    mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sentiment)) +
    geom_col() +
    scale_fill_manual(values = brewer.pal(8,'Dark2')[c(2,5)]) +
    coord_flip(ylim = c(-7,7)) +
    labs(y = "Frecuencia",
         x = NULL,
         title = "Rock") +
    theme_minimal() +
    theme(legend.position = "none") -> p3
#-------------Salsa_canciones------------------
text_Salsa_canciones %>%
    inner_join(sentiment_words) %>%
    count(word, sentiment, sort = TRUE) %>%
    filter(n > 2) %>%
    mutate(n = ifelse(sentiment == "Negativo", -n, n)) %>%
    mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sentiment)) +
    geom_col() +
    scale_fill_manual(values = brewer.pal(8,'Dark2')[c(2,5)]) +
    coord_flip(ylim = c(-7,7)) +
    labs(y = "Frecuencia",
         x = NULL,
         title = "Salsa",
         fill = "Sentimiento"
         ) +
    theme_minimal() -> p4
# desplegar grafico
grid.arrange(p1, p2, p3, p4, ncol  = 4)
```




```{r, fig.width=10, fig.height=6, fig.align='center'}
suppressMessages(suppressWarnings(library(reshape2)))  # acast

##### viz
par(mfrow = c(2,2), mar = c(1,1,3,1), mgp = c(1,1,1))
# ---------- Baladas ----------
set.seed(123)
text_Baladas %>%
  inner_join(sentiment_words) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(
    colors = c("darkred", "darkgreen"),
    title.size = 0.01,
    title.colors = c("white", "white"),
    family = "serif",
    scale = c(3,1),
    max.words = 50 
    )
title(main = "Baladas: NB Sentimiento")
# ---------- Reggaeton ----------
set.seed(123)
text_Reggaeton %>%
  inner_join(sentiment_words) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(
    colors = c("red", "green"),
    title.size = 1.5,
    family = "serif",
    scale = c(3,1),
    max.words = 50 
  )
title(main = "Reggaeton: NB Sentimiento")
#--------Rock_canciones---------
set.seed(123)
text_Rock_canciones %>%
  inner_join(sentiment_words) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(
    colors = c("red", "green"),
    title.size = 1.5,
    family = "serif",
    scale = c(3,1),
    max.words = 50 
  )
title(main = "Rock: NB Sentimiento")
#--------Salsa_canciones---------
set.seed(123)
text_Salsa_canciones %>%
  inner_join(sentiment_words) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(
    colors = c("darkred", "darkgreen"),
    title.size = 1.5,
    family = "serif",
    scale = c(3,1),
    max.words = 50 
  )
title(main = "Salsa: NB Sentimiento")
```

# Baladas: Bigramas

Se ha usado `unnest_tokens` para tokenizar por palabras individuales.

Ahora se quiere tokenizar por **secuencias de palabras**.

¿Qué palabras tienden a seguir otras? ¿Qué palabras tienden a co-ocurrir juntas?


```{r}
##### bigramas: Ejemplo cancion Rock_canciones
# texto
text <- c("Préstame tu peine",
          "Y péiname el alma",
          "Desenrédame",
          "Fuera de este mundo",
          "Dime que no estoy",
          "Soñándote",
          "Enséñame",
          "De qué estamos hechos",
          "Que quiero orbitar planetas",
          "Hasta ver uno vació",
          "Que quiero irme a vivir",
          "Pero que sea contigo",
          "Viento",
          "Amárranos",
          "Tiempo",
          "Detente muchos años",
          "Viento",
          "Amárranos",
          "Tiempo",
          "Detente muchos años")

# convertir a data frame
text_df <- tibble(line = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  head(n = 10)
```

```{r}
#### bigramas: Ejemplo cancion Baladas
# texto
text <- c("Que si pudiera darle vueltas a la Tierra una y otra vez",
          "Yo buscaría de alguien con tus mismos ojos, con tus mismos labios",
          "Con tu misma boca y con tu misma piel",
          "Que si pudiera darle al tiempo otro poco de tiempo",
          "Para comprender que sin ti, mi vida ya no la siento",
          "Que el color se vuelve a blanco y negro",
          "Y sé que la distancia me hizo ciego",
          "En todos los momentos",
          "Los que tenía que verte aquí, Que si pudiera darle vueltas a la Tierra una y otra vez",
          "Yo buscaría de alguien con tus mismos ojos, con tus mismos labios",
          "Con tu misma boca y con tu misma piel",
          "Que si pudiera darle al tiempo otro poco de tiempo",
          "Para comprender que sin ti, mi vida ya no la siento",
          "Que el color se vuelve a blanco y negro",
          "Y sé que la distancia me hizo ciego",
          "En todos los momentos",
          "Los que tenía que verte aquí")

#convertir a data frame
text_df <- tibble(line = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  head(n = 10)
```

```{r}
##### bigramas: Ejemplo Reggaeton
# Texto
text <- c("No hay que sufrir, no hay que llorar",
          "La vida es una y es un carnaval",
          "baladas Lo malo se irá, todo pasará",
          "La vida es una y es un carnaval",
          "La vida es una y es un carnaval",
          "La vida es una y es un carnaval",
          "Seré tu ángel guardián",
          "Tu mejor compañía",
          "Toma fuerte mi mano",
          "Te enseñaré a volar",
          "Ya no habrá mal de amores",
          "Vendrán tiempos mejores",
          "Levanta ya tu mano que vinimos a gozar")

#convertir a data frame
text_df <- tibble(line = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  head(n = 10)
          
```

```{r}
#### bigramas: Ejemplo Salsa
# Texto
text <- c("Me siento en el techo y empiezo a ordenar para ti",
          "Los besos que no pude dibujar",
          "Sale el sol, me acaricia",
          "Nace tu canción",
          "La gente como tú, enciende mi ser",
          "Perdóname si molesto, estas cosas que hago yo",
          "Ya ves, ya he olvidado o si son verdes o son azul",
          "Y te diré, tus ojos viven en mi",
          "Y son los más tiernos de la mayoría")

#convertir a data frame
text_df <- tibble(line = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  head(n = 10)
```


```{r}
##### importar datos
text_Rock_canciones <- unlist(c(read_csv("Rock_canciones.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Rock_canciones) <- NULL
text_Rock_canciones <- tibble(line = 1:length(text_Rock_canciones), text = text_Rock_canciones)
```
```{r}
##### importar datos
text_Baladas <- unlist(c(read_csv("Baladas.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Baladas) <- NULL
text_Baladas<- tibble(line = 1:length(text_Baladas), text = text_Baladas)
```

```{r}
##### importar datos
text_Reggaeton <- unlist(c(read_csv("Reggaeton_proyecto.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Reggaeton) <- NULL
text_Reggaeton <- tibble(line = 1:length(text_Reggaeton), text = text_Reggaeton)
```

```{r}
##### importar datos
text_Salsa_canciones <- unlist(c(read_csv("Salsa_canciones.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Salsa_canciones) <- NULL
text_Salsa_canciones <- tibble(line = 1:length(text_Salsa_canciones), text = text_Salsa_canciones)
```



```{r}
##### tokenizar en bigramas
# en este caso cada token es un bigrama
text_Rock_canciones %>%
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  filter(!is.na(bigram)) -> text_Rock_canciones_bi  # importante!
dim(text_Rock_canciones_bi)
head(text_Rock_canciones_bi, n = 10)
```

```{r}
##### tokenizar en bigramas
# en este caso cada token es un bigrama
text_Baladas %>%
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  filter(!is.na(bigram)) -> text_Baladas_bi  # importante!
dim(text_Baladas_bi)
head(text_Baladas_bi, n = 10)
```
```{r}
##### tokenizar en bigramas
# en este caso cada token es un bigrama
text_Reggaeton %>%
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  filter(!is.na(bigram)) -> text_Reggaeton_bi  # importante!
dim(text_Reggaeton_bi)
head(text_Reggaeton_bi, n = 10)
```
```{r}
##### tokenizar en bigramas
# en este caso cada token es un bigrama
text_Salsa_canciones %>%
  unnest_tokens(tbl = ., input = text, output = bigram, token = "ngrams", n = 2) %>%
  filter(!is.na(bigram)) -> text_Salsa_canciones_bi  # importante!
dim(text_Salsa_canciones_bi)
head(text_Salsa_canciones_bi, n = 10)
```



```{r}
###### top 10 de bigramas mas frecuentes
# hay bigramas que no son interesantes (e.g., "de la")
# esto motiva el uso de stop words nuevamente
text_Rock_canciones_bi %>%
  count(bigram, sort = TRUE) %>%
  head(n = 10)
```

```{r}
###### top 10 de bigramas mas frecuentes
# hay bigramas que no son interesantes (e.g., "de la")
# esto motiva el uso de stop words nuevamente
text_Baladas_bi %>%
  count(bigram, sort = TRUE) %>%
  head(n = 10)
```

```{r}
###### top 10 de bigramas mas frecuentes
# hay bigramas que no son interesantes (e.g., "de la")
# esto motiva el uso de stop words nuevamente
text_Reggaeton_bi %>%
  count(bigram, sort = TRUE) %>%
  head(n = 10)
```
```{r}
###### top 10 de bigramas mas frecuentes
# hay bigramas que no son interesantes (e.g., "de la")
# esto motiva el uso de stop words nuevamente
text_Salsa_canciones_bi %>%
  count(bigram, sort = TRUE) %>%
  head(n = 10)
```

```{r}
##### omitir stop words
text_Rock_canciones_bi %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Rock_canciones_bi_counts  # importante para la conformacion de la red!
dim(text_Rock_canciones_bi_counts)
head(text_Rock_canciones_bi_counts, n = 10)
```

```{r}
##### omitir stop words
text_Baladas_bi %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Baladas_bi_counts  # importante para la conformacion de la red!
dim(text_Baladas_bi_counts)
head(text_Baladas_bi_counts, n = 10)
```

```{r}
##### omitir stop words
text_Reggaeton_bi %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Reggaeton_bi_counts  # importante para la conformacion de la red!
dim(text_Reggaeton_bi_counts)
head(text_Reggaeton_bi_counts, n = 10)
```
```{r}
##### omitir stop words
text_Salsa_canciones_bi %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Salsa_canciones_bi_counts  # importante para la conformacion de la red!
dim(text_Salsa_canciones_bi_counts)
head(text_Salsa_canciones_bi_counts, n = 10)
```

```{r, fig.width=6, fig.height=6, fig.align='center'}
##### definir una red a partir de la frecuencia (weight) de los bigramas
# binaria, no dirigida, ponderada, simple
# se recomienda variar el umbral del filtro y construir bigramas no consecutivos para obtener redes con mayor informacion
suppressMessages(suppressWarnings(library(igraph)))
g <- text_Rock_canciones_bi_counts %>%
  filter(weight > 2) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_fr, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'black', vertex.label.cex = 1, vertex.label.dist = 1, main = "Bigramas Rock con Umbral = 3")
```

```{r, fig.width=6, fig.height=6, fig.align='center'}
##### definir una red a partir de la frecuencia (weight) de los bigramas
# binaria, no dirigida, ponderada, simple
# se recomienda variar el umbral del filtro y construir bigramas no consecutivos para obtener redes con mayor informacion
suppressMessages(suppressWarnings(library(igraph)))
g <- text_Baladas_bi_counts %>%
  filter(weight > 2) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_fr, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'purple', vertex.label.cex = 1, vertex.label.dist = 1, main = "Bigramas Baladas con Umbral = 1")

```
```{r, fig.width=6, fig.height=6, fig.align='center'}
##### definir una red a partir de la frecuencia (weight) de los bigramas
# binaria, no dirigida, ponderada, simple
# se recomienda variar el umbral del filtro y construir bigramas no consecutivos para obtener redes con mayor informacion
suppressMessages(suppressWarnings(library(igraph)))
g <- text_Reggaeton_bi_counts %>%
  filter(weight > 2) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_fr, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'maroon', vertex.label.cex = 1, vertex.label.dist = 1, main = "Bigramas Reggaeton con Umbral = 2")
```
```{r, fig.width=6, fig.height=6, fig.align='center'}
##### definir una red a partir de la frecuencia (weight) de los bigramas
# binaria, no dirigida, ponderada, simple
# se recomienda variar el umbral del filtro y construir bigramas no consecutivos para obtener redes con mayor informacion
suppressMessages(suppressWarnings(library(igraph)))
g <- text_Salsa_canciones_bi_counts %>%
  filter(weight > 2) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_fr, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'navyblue', vertex.label.cex = 1, vertex.label.dist = 1, main = "Bigramas Salsa con Umbral = 4")
```



```{r, fig.width=6, fig.height=6, fig.align='center'}
##### red con un umbral diferente
g <- text_Rock_canciones_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label = NA, main = "Umbral = 3")
```

```{r, fig.width=6, fig.height=6, fig.align='center'}
##### red con un umbral diferente
g <- text_Baladas_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label = NA, main = "Umbral = 1")
```
```{r, fig.width=6, fig.height=6, fig.align='center'}
##### red con un umbral diferente
g <- text_Reggaeton_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label = NA, main = "Umbral = 2")
```
```{r, fig.width=6, fig.height=6, fig.align='center'}
##### red con un umbral diferente
g <- text_Salsa_canciones_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# viz
set.seed(123)
plot(g, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label = NA, main = "Umbral = 4")
```


```{r, fig.width=12, fig.height=6, fig.align='center'}
##### componente conexa mas grande de la red
g <- text_Rock_canciones_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'black', vertex.label.cex = 0.9, vertex.label.dist = 1)
# viz 2
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = adjustcolor('red4', 0.1), vertex.frame.color = 'red4', vertex.size = 2*strength(gcc), vertex.label.color = 'black', vertex.label.cex = 0.9, vertex.label.dist = 1, edge.width = 3*E(g)$weight/max(E(g)$weight))
title(main = "Componente conexa Rock Canciones", outer = T, line = -1)
```

```{r, fig.width=12, fig.height=6, fig.align='center'}
##### componente conexa mas grande de la red
g <- text_Baladas_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'black', vertex.label.cex = 0.6, vertex.label.dist = 2)
# viz 2
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = adjustcolor('green4', 0.1), vertex.frame.color = 'green4', vertex.size = 2*strength(gcc), vertex.label.color = 'black', vertex.label.cex = 0.9, vertex.label.dist = 1, edge.width = 3*E(g)$weight/max(E(g)$weight))
title(main = "Componente conexa Baladas", outer = T, line = -1)
```
```{r, fig.width=12, fig.height=6, fig.align='center'}
##### componente conexa mas grande de la red
g <- text_Reggaeton_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'black', vertex.label.cex = 0.6, vertex.label.dist = 2)
# viz 2
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = adjustcolor('blue4', 0.1), vertex.frame.color = 'blue4', vertex.size = 2*strength(gcc), vertex.label.color = 'black', vertex.label.cex = 0.9, vertex.label.dist = 1, edge.width = 3*E(g)$weight/max(E(g)$weight))
title(main = "Componente conexa Reggaeton", outer = T, line = -1)
```
```{r, fig.width=12, fig.height=6, fig.align='center'}
##### componente conexa mas grande de la red
g <- text_Salsa_canciones_bi_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label.color = 'black', vertex.label.cex = 0.6, vertex.label.dist = 2)
# viz 2
set.seed(123)
plot(gcc, layout = layout_with_kk, vertex.color = adjustcolor('purple4', 0.1), vertex.frame.color = '4', vertex.size = 2*strength(gcc), vertex.label.color = 'black', vertex.label.cex = 0.9, vertex.label.dist = 1, edge.width = 3*E(g)$weight/max(E(g)$weight))
title(main = "Componente conexa Baladas", outer = T, line = -1)
```



# Baladas: Skip-grams


```{r}
##### skip-gram: Ejemplo cancion Viento_Caifanes
# texto
text <- c("Préstame tu peine",
          "Y péiname el alma",
          "Desenrédame",
          "Fuera de este mundo",
          "Dime que no estoy",
          "Soñándote",
          "Enséñame",
          "De qué estamos hechos",
          "Que quiero orbitar planetas",
          "Hasta ver uno vació",
          "Que quiero irme a vivir",
          "Pero que sea contigo",
          "Viento",
          "Amárranos",
          "Tiempo",
          "Detente muchos años",
          "Viento",
          "Amárranos",
          "Tiempo",
          "Detente muchos años")
# convertir a data frame
text_df <- tibble(line = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  head(n = 10)
```
```{r}
##### skip-gram: Ejemplo cancion: Tabaco y Chanel
# texto
text <- c("Un olor a tabaco y Chanel",
"Me recuerda el olor de su piel",
"Una mezcla de miel y café",
"Me recuerda el sabor de sus besos",
"El color del final de la noche",
"Me pregunta dónde fui a parar, dónde estás",
"Que esto solo se vive una vez",
"Dónde fuiste a parar, dónde estás",
"Un olor a tabaco y Chanel",
"Y una mezcla de miel y café",
"Me preguntan por ella (ella) Me",
"preguntan por ella",
"Me preguntan también las estrellas",
"Me reclaman que vuelva por ella",
"Ay, que vuelva por ella (ella)",
"Ay, que vuelva por ella)")
# convertir a data frame
text_df <- tibble(line  = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  head(n = 10)

```
```{r}
##### skip-gram: Ejemplo cancion: Safari
# texto
text <- c("Oye, papi, vamos con mis amigas para el party",
"Tengo algo por un animal",
"Cuando mi gente está aquí, hay tsunami",
"Wavy, así es lo que me gusta",
"You know I like it when tú fresco",
"Me llamo princesa",
"Voy a coger provecho",
"Lo que me gusta",
"You know I like it when tú fresco",
"Me llamo princesa",
"Voy a coger provecho")
# convertir a data frame
text_df <- tibble(line  = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  head(n = 10)
```

```{r}
##### skip-gram: Ejemplo cancion: Salsa-Yuribuenaventura
# texto
text <- c("La salsa que aquí les traigo",
"la traigo directo mira",
"la traigo de las entrañas",
"de mi américa latina",

"El día que estes llorando",
"y tu alma se encuentre triste",
"si bailas salsa mi hermano",
"olvidarás que lo fuiste")
# convertir a data frame
text_df <- tibble(line  = 1:length(text), text = text)
# tokenizar en bigramas
text_df %>% 
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  head(n = 10)

```

```{r}
##### importar datos Rock
text_Rock_canciones <- unlist(c(read_csv("Rock_canciones.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_Rock_canciones) <- NULL
text_Rock_canciones <- tibble(line = 1:length(text_Rock_canciones), text = text_Rock_canciones)

##### importar datos Baladas
text_baladas <- unlist(c(read_csv("baladas.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_baladas) <- NULL
text_baladas <- tibble(line = 1:length(text_baladas), text = text_baladas)

##### importar datos Reggaeton
text_reggaeton <- unlist(c(read_csv("Reggaeton_proyecto.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_reggaeton) <- NULL
text_reggaeton <- tibble(line = 1:length(text_reggaeton), text = text_reggaeton)

##### importar datos Salsa
text_salsa <- unlist(c(read_csv("Salsa_canciones.txt", col_names = FALSE, show_col_types = FALSE)))
names(text_salsa) <- NULL
text_salsa <- tibble(line = 1:length(text_salsa), text = text_salsa)
```


```{r}
##### tokenizar en skip-gram
# en este caso cada token es un unigrama o un bigrama regular o un bigrama con espaciamiento
# Rock
text_Rock_canciones %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_Rock_canciones_skip
dim(text_Rock_canciones_skip)
head(text_Rock_canciones_skip, n = 10)

# Baladas
text_baladas %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_baladas_skip
dim(text_baladas_skip)
head(text_baladas_skip, n = 10)

# Reggaeton
text_reggaeton %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_reggaeton_skip
dim(text_reggaeton_skip)
head(text_reggaeton_skip, n = 10)

# Salsa
text_salsa %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_salsa_skip
dim(text_salsa_skip)
head(text_salsa_skip, n = 10)

```




```{r}
##### remover unigramas
suppressMessages(suppressWarnings(library(ngram)))

# 1) Rock
# Contar palabras en cada skip-gram
text_Rock_canciones_skip$num_words <- text_Rock_canciones_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
head(text_Rock_canciones_skip, n = 10)
# remover unigramas
text_Rock_canciones_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)
dim(text_Rock_canciones_skip)
head(text_Rock_canciones_skip, n = 10)

# 2) Baladas

# Contar palabras en cada skip-gram
text_baladas_skip$num_words <- text_baladas_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
head(text_baladas_skip, n = 10)

# Remover unigramas (solo conservar los skip-grams de 2 palabras)
text_baladas_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)

dim(text_baladas_skip)
head(text_baladas_skip, n = 10)

# 3) Reggaeton

# Contar palabras en cada skip-gram
text_reggaeton_skip$num_words <- text_reggaeton_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
head(text_reggaeton_skip, n = 10)

# Remover unigramas (solo conservar los skip-grams de 2 palabras)
text_reggaeton_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)

dim(text_reggaeton_skip)
head(text_reggaeton_skip, n = 10)


# 4) Salsa

# Contar palabras en cada skip-gram
text_salsa_skip$num_words <- text_salsa_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
head(text_salsa_skip, n = 10)

# Remover unigramas (solo conservar los skip-grams de 2 palabras)
text_salsa_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)

dim(text_salsa_skip)
head(text_salsa_skip, n = 10)
```



```{r}
##### Omitir stop words

##### Rock
text_Rock_canciones_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Rock_canciones_skip_counts
dim(text_Rock_canciones_skip_counts)
head(text_Rock_canciones_skip_counts, n = 10)

##### Baladas
text_baladas_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(
           old = names(replacement_list) %>% str_c(collapse = ''),
           new = replacement_list %>% str_c(collapse = ''),
           x = word1
         )) %>%
  mutate(word2 = chartr(
           old = names(replacement_list) %>% str_c(collapse = ''),
           new = replacement_list %>% str_c(collapse = ''),
           x = word2
         )) %>%
  filter(!is.na(word1)) %>%
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_baladas_skip_counts

dim(text_baladas_skip_counts)
head(text_baladas_skip_counts, n = 10)


##### Reggaeton
text_reggaeton_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(
           old = names(replacement_list) %>% str_c(collapse = ''),
           new = replacement_list %>% str_c(collapse = ''),
           x = word1
         )) %>%
  mutate(word2 = chartr(
           old = names(replacement_list) %>% str_c(collapse = ''),
           new = replacement_list %>% str_c(collapse = ''),
           x = word2
         )) %>%
  filter(!is.na(word1)) %>%
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_reggaeton_skip_counts

dim(text_reggaeton_skip_counts)
head(text_reggaeton_skip_counts, n = 10)


##### Salsa
text_salsa_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(
           old = names(replacement_list) %>% str_c(collapse = ''),
           new = replacement_list %>% str_c(collapse = ''),
           x = word1
         )) %>%
  mutate(word2 = chartr(
           old = names(replacement_list) %>% str_c(collapse = ''),
           new = replacement_list %>% str_c(collapse = ''),
           x = word2
         )) %>%
  filter(!is.na(word1)) %>%
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_salsa_skip_counts

dim(text_salsa_skip_counts)
head(text_salsa_skip_counts, n = 10)
```



```{r, fig.width=12, fig.height=6, fig.align='center'}
##### definir una red a partir de la frecuencia (weight) de los bigramas

##### Rock
g <- text_Rock_canciones_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)  # importante!
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc, layout = layout_with_fr, vertex.color = 1, vertex.frame.color = 1, vertex.size = 3, vertex.label = NA)
# viz 2
set.seed(123)
plot(gcc, layout = layout_with_fr, vertex.color = adjustcolor('red4', 0.1), vertex.frame.color = 'red4', vertex.size = 2*strength(gcc), vertex.label = NA)
title(main = "Componente conexa y Clusters - Rock", outer = T, line = -1)


##### Baladas
g <- text_baladas_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)

# Grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))

par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# Viz 1
set.seed(123)
plot(
  gcc,
  layout       = layout_with_fr,
  vertex.color = "skyblue",
  vertex.frame.color = "black",
  vertex.size  = 2,
  vertex.label = NA
)
# Viz 2
set.seed(123)
plot(
  gcc,
  layout       = layout_with_fr,
  vertex.color = adjustcolor('salmon', 0.1),
  vertex.frame.color = 'salmon',
  vertex.size  = 2*strength(gcc),
  vertex.label = NA
)
title(main = "Componente conexa y Clusters - Baladas", outer = TRUE, line = -1)


##### Reggaeton
g <- text_reggaeton_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)

# Grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))

par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# Viz 1
set.seed(123)
plot(
  gcc,
  layout             = layout_with_fr,
  vertex.color       = "gold",
  vertex.frame.color = "gold",
  vertex.size        = 2,
  vertex.shape       = "square",
  vertex.label       = NA
)
# Viz 2
set.seed(123)
plot(
  gcc,
  layout       = layout_with_fr,
  vertex.color = adjustcolor('lightgreen', 0.1),
  vertex.frame.color = 'darkgreen',
  vertex.size  = 2*strength(gcc),
  vertex.label = NA
)
title(main = "Componente conexa y Clusters - Reggaeton", outer = TRUE, line = -1)


##### Salsa
g <- text_salsa_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)

# Grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))

par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# Viz 1
set.seed(123)
plot(
  gcc,
  layout             = layout_with_fr,
  vertex.color       = "firebrick4",
  vertex.frame.color = "firebrick3",
  vertex.size        = 3,
  vertex.shape       = "pie",
  vertex.label       = NA
)
# Viz 2
set.seed(123)
plot(
  gcc,
  layout       = layout_with_fr,
  vertex.color = adjustcolor('chocolate4', 0.1),
  vertex.frame.color = 'chocolate4',
  vertex.size  = 2*strength(gcc),
  vertex.label = NA
)
title(main = "Componente conexa y Clusters - Salsa", outer = TRUE, line = -1)

```
# Comparación

Géneros de Música Colombiana. 

Skip-grams.

Componente conexa de la red conformada con umbral 1.


## Redes
```{r, echo = F}
##### importar datos
text_Baladas <- suppressWarnings(unlist(c(read_csv("baladas.txt", col_names = FALSE, show_col_types = FALSE))))
names(text_Baladas) <- NULL
text_Baladas <- tibble(line = 1:length(text_Baladas), text = text_Baladas)
##### tokenizar en skip-gram
text_Baladas %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_Baladas_skip
##### remover unigramas
text_Baladas_skip$num_words <- text_Baladas_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
text_Baladas_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)
##### omitir stop words
text_Baladas_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Baladas_skip_counts
##### definir una red a partir de la frecuencia (weight) de los bigramas
g <- text_Baladas_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc_Baladas <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))

```

```{r, echo = F}
##### importar datos
text_Reggaeton <- suppressWarnings(unlist(c(read_csv("Reggaeton_proyecto.txt", col_names = FALSE, show_col_types = FALSE))))
names(text_Reggaeton) <- NULL
text_Reggaeton <- tibble(line = 1:length(text_Reggaeton), text = text_Reggaeton)
##### tokenizar en skip-gram
text_Reggaeton %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_Reggaeton_skip
##### remover unigramas
text_Reggaeton_skip$num_words <- text_Reggaeton_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
text_Reggaeton_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)
##### omitir stop words
text_Reggaeton_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Reggaeton_skip_counts
##### definir una red a partir de la frecuencia (weight) de los bigramas
g <- text_Reggaeton_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc_Reggaeton <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
```

```{r, echo = F}
##### importar datos
text_Rock_canciones <- suppressWarnings(unlist(c(read_csv("Rock_canciones.txt", col_names = FALSE, show_col_types = FALSE))))
names(text_Rock_canciones) <- NULL
text_Rock_canciones <- tibble(line = 1:length(text_Rock_canciones), text = text_Rock_canciones)
##### tokenizar en skip-gram
text_Rock_canciones %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_Rock_canciones_skip
##### remover unigramas
text_Rock_canciones_skip$num_words <- text_Rock_canciones_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
text_Rock_canciones_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)
##### omitir stop words
text_Rock_canciones_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Rock_canciones_skip_counts
##### definir una red a partir de la frecuencia (weight) de los bigramas
g <- text_Rock_canciones_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc_Rock_canciones <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
```

```{r, echo = F}
##### importar datos
text_Salsa_canciones <- suppressWarnings(unlist(c(read_csv("Salsa_canciones.txt", col_names = FALSE, show_col_types = FALSE))))
names(text_Salsa_canciones) <- NULL
text_Salsa_canciones <- tibble(line = 1:length(text_Salsa_canciones), text = text_Salsa_canciones)
##### tokenizar en skip-gram
text_Salsa_canciones %>%
  unnest_tokens(tbl = ., input = text, output = skipgram, token = "skip_ngrams", n = 2) %>%
  filter(!is.na(skipgram)) -> text_Salsa_canciones_skip
##### remover unigramas
text_Salsa_canciones_skip$num_words <- text_Salsa_canciones_skip$skipgram %>% 
  map_int(.f = ~ wordcount(.x))
text_Salsa_canciones_skip %<>% 
  filter(num_words == 2) %>% 
  select(-num_words)
##### omitir stop words
text_Salsa_canciones_skip %>%
  separate(skipgram, c("word1", "word2"), sep = " ") %>%
  filter(!grepl(pattern = '[0-9]', x = word1)) %>%
  filter(!grepl(pattern = '[0-9]', x = word2)) %>%
  filter(!word1 %in% stop_words_es$word) %>%
  filter(!word2 %in% stop_words_es$word) %>%
  mutate(word1 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word1)) %>%
  mutate(word2 = chartr(old = names(replacement_list) %>% str_c(collapse = ''), 
                       new = replacement_list %>% str_c(collapse = ''),
                       x = word2)) %>%
  filter(!is.na(word1)) %>% 
  filter(!is.na(word2)) %>%
  count(word1, word2, sort = TRUE) %>%
  rename(weight = n) -> text_Salsa_canciones_skip_counts
##### definir una red a partir de la frecuencia (weight) de los bigramas
g <- text_Salsa_canciones_skip_counts %>%
  filter(weight > 0) %>%
  graph_from_data_frame(directed = FALSE)
g <- igraph::simplify(g)
# grafo inducido por la componente conexa
V(g)$cluster <- clusters(graph = g)$membership
gcc_Salsa_canciones <- induced_subgraph(graph = g, vids = which(V(g)$cluster == which.max(clusters(graph = g)$csize)))
```

```{r, fig.width=12, fig.height=6, fig.align='center', echo = F}
par(mfrow = c(1,4), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc_Baladas, layout = layout_with_kk, vertex.color = adjustcolor('red4', 0.1), vertex.frame.color = 'red4', vertex.size = 1.6*strength(gcc_Baladas), vertex.label = NA, main = "Baladas")
# viz 2
set.seed(123)
plot(gcc_Reggaeton, layout = layout_with_kk, vertex.color = adjustcolor('blue4', 0.1), vertex.frame.color = 'blue4', vertex.size = 1.6*strength(gcc_Reggaeton), vertex.label = NA, main = "Reggaeton")
# viz 3
set.seed(123)
plot(gcc_Rock_canciones, layout = layout_with_kk, vertex.color = adjustcolor('purple4', 0.1), vertex.frame.color = 'purple4', vertex.size = 1.6*strength(gcc_Rock_canciones), vertex.label = NA, main = "Rock_canciones")
# viz 4
set.seed(1234)
plot(gcc_Salsa_canciones, layout = layout_with_kk, vertex.color = adjustcolor('yellow4', 0.1), vertex.frame.color = 'yellow4', vertex.size = 1.6*strength(gcc_Salsa_canciones), vertex.label = NA, main = "Salsa_canciones")
```
## Paralabras más importantes

### Baladas: Top 10 {-}

```{r, echo = F}
centralidad_Baladas <- tibble(word = V(gcc_Baladas)$name, eigen = eigen_centrality(gcc_Baladas, scale = T)$vector)
centralidad_Baladas %>%
  arrange(desc(eigen)) %>%
  head(n = 10)
```


### Reggaeton: Top 10 {-}

```{r, echo = F}
centralidad_Reggaeton <- tibble(word = V(gcc_Reggaeton)$name, eigen = eigen_centrality(gcc_Reggaeton, scale = T)$vector)
centralidad_Reggaeton %>%
  arrange(desc(eigen)) %>%
  head(n = 10)
```

## Rock : Top 10 {-}

```{r, echo = F}
centralidad_Rock_canciones <- tibble(word = V(gcc_Rock_canciones)$name, eigen = eigen_centrality(gcc_Rock_canciones, scale = T)$vector)
centralidad_Rock_canciones %>%
  arrange(desc(eigen)) %>%
  head(n = 10)
```
## Salsa : Top 10 {-}
```{r, echo = F}
centralidad_Salsa_canciones <- tibble(word = V(gcc_Salsa_canciones)$name, eigen = eigen_centrality(gcc_Salsa_canciones, scale = T)$vector)
centralidad_Salsa_canciones %>%
  arrange(desc(eigen)) %>%
  head(n = 10)

```





## Agrupamiento

```{r, echo = F}
kc_Baladas <- igraph::cluster_fast_greedy(gcc_Baladas)
kc_Reggaeton <- igraph::cluster_fast_greedy(gcc_Reggaeton)
kc_Rock_canciones <- igraph:: cluster_fast_greedy(gcc_Rock_canciones)
kc_Salsa_canciones <- igraph:: cluster_fast_greedy(gcc_Salsa_canciones)
tab <- cbind(
  c(length(kc_Baladas), min(sizes(kc_Baladas)), max(sizes(kc_Baladas))),
  c(length(kc_Reggaeton), min(sizes(kc_Reggaeton)), max(sizes(kc_Reggaeton))),
  c(length(kc_Rock_canciones),min(sizes(kc_Rock_canciones)),max(sizes(kc_Rock_canciones))),
  c(length(kc_Salsa_canciones),min(sizes(kc_Salsa_canciones)),max(sizes(kc_Salsa_canciones)))
)
rownames(tab) <- c("Tamaño partición", "Tamaño grupo menor", "Tamaño grupo mayor")
colnames(tab) <- c("Baladas","Reggaeton","Rock_canciones", " Salsa_canciones")
round(tab, 4)                                     
```

```{r, fig.width=12, fig.height=6, fig.align='center', echo = F}
suppressMessages(suppressWarnings(library(RColorBrewer)))
cols <- c(brewer.pal(9,"Set1")[1:9],brewer.pal(8,"Set2")[1:7],brewer.pal(8,"Set2")[1:7],brewer.pal(12,"Set3")[1:3])
par(mfrow = c(1,2), mar = c(1,1,2,1), mgp = c(1,1,1))
# viz 1
set.seed(123)
plot(gcc_Baladas, layout = layout_with_kk, vertex.color = adjustcolor(cols[kc_Baladas$membership], 0.1), vertex.frame.color = cols[kc_Baladas$membership], vertex.size = 1.6*strength(gcc_Baladas), vertex.label = NA, main = "Baladas")
# viz 2
set.seed(123)
plot(gcc_Reggaeton, layout = layout_with_kk, vertex.color = adjustcolor(cols[kc_Reggaeton$membership], 0.1), vertex.frame.color = cols[kc_Reggaeton$membership], vertex.size = 1.6*strength(gcc_Reggaeton), vertex.label = NA, main = "Reggaeton")
#viz 3
set.seed(123)
plot(gcc_Rock_canciones, layout = layout_with_kk, vertex.color = adjustcolor(cols[kc_Rock_canciones$membership], 0.1), vertex.frame.color = cols[kc_Rock_canciones$membership], vertex.size = 1.6*strength(gcc_Rock_canciones), vertex.label = NA, main = "Rock")
#viz 4
set.seed(1234)
plot(gcc_Salsa_canciones, layout = layout_with_kk, vertex.color = adjustcolor(cols[kc_Salsa_canciones$membership], 0.1), vertex.frame.color = cols[kc_Salsa_canciones$membership], vertex.size = 1.6*strength(gcc_Salsa_canciones), vertex.label = NA, main = "Salsa")
```

### Baladas: Top 5 grupo mayor {-}

```{r, echo=F}
V(gcc_Baladas)$membership <- kc_Baladas$membership
grupos_Baladas<- tibble(word = V(gcc_Baladas) %>% names(), cluster = V(gcc_Baladas)$membership, eigen = eigen_centrality(gcc_Baladas, scale = T)$vector)
grupos_Baladas %>%
  filter(cluster == which.max(table(kc_Baladas$membership))) %>%
  arrange(desc(eigen)) %>%
  head(n = 5)
```
### Reggaeton: Top 5 grupo mayor {-}

```{r, echo=F}
V(gcc_Reggaeton)$membership <- kc_Reggaeton$membership
grupos_Reggaeton <- tibble(word = V(gcc_Reggaeton) %>% names(), cluster = V(gcc_Reggaeton)$membership, eigen = eigen_centrality(gcc_Reggaeton, scale = T)$vector)
grupos_Reggaeton %>%
  filter(cluster == which.max(table(kc_Reggaeton$membership))) %>%
  arrange(desc(eigen)) %>%
  head(n = 5)
```

### Rock: Top 5 grupo mayor {-}
```{r, echo=F}
V(gcc_Rock_canciones)$membership <- kc_Rock_canciones$membership
grupos_Rock_canciones <- tibble(word = V(gcc_Rock_canciones) %>% names(), cluster = V(gcc_Rock_canciones)$membership, eigen = eigen_centrality(gcc_Rock_canciones, scale = T)$vector)
grupos_Rock_canciones %>%
  filter(cluster == which.max(table(kc_Rock_canciones$membership))) %>%
  arrange(desc(eigen)) %>%
  head(n = 5)
```
### Salsa: Top 5 grupo mayor {-}
```{r, echo = F}
V(gcc_Salsa_canciones)$membership <- kc_Salsa_canciones$membership
grupos_Salsa_canciones <- tibble(word = V(gcc_Salsa_canciones) %>% names(), cluster = V(gcc_Salsa_canciones)$membership, eigen = eigen_centrality(gcc_Salsa_canciones, scale = T)$vector)
grupos_Salsa_canciones %>%
  filter(cluster == which.max(table(kc_Salsa_canciones$membership))) %>%
  arrange(desc(eigen)) %>%
  head(n = 5)

```




